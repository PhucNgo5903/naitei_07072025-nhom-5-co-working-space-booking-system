<!-- templates/admin/users/user-list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin_layout}">
<head>
    <meta charset="UTF-8">
</head>
<body th:with="pageTitle=#{user.management.title}">
<div layout:fragment="content">
    <h2 th:text="#{user.list.title}">Quản lý người dùng</h2>
    <hr class="text-secondary">

    <!-- Hiển thị message -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Filter form -->
    <form method="get" class="row g-3 mb-3">
        <div class="col-auto">
            <label for="role" class="form-label" th:text="#{user.filter.role.label}">Filter by role:</label>
            <select id="role" name="role" class="form-select">
                <option value="" th:selected="${selectedRole == null}" th:text="#{user.filter.all.roles}">All roles</option>
                <option th:each="r : ${roles}"
                        th:value="${r}"
                        th:text="${r == T(naitei.group5.workingspacebooking.entity.enums.UserRole).admin} ? #{user.role.admin} : 
                                 (${r == T(naitei.group5.workingspacebooking.entity.enums.UserRole).renter} ? #{user.role.renter} : 
                                 (${r == T(naitei.group5.workingspacebooking.entity.enums.UserRole).owner} ? #{user.role.owner} : #{user.role.pending.owner}))"
                        th:selected="${selectedRole == r}">
                </option>
            </select>
        </div>
        <div class="col-auto d-flex align-items-end">
            <button type="submit" class="btn btn-primary" th:text="#{user.filter.button}">Filter</button>
        </div>
    </form>

    <table class="table table-striped table-light text-dark align-middle">
        <thead>
        <tr>
            <th th:text="#{user.table.index}">#</th>
            <th th:text="#{user.table.name}">Name</th>
            <th th:text="#{user.table.email}">Email</th>
            <th th:text="#{user.table.role}">Role</th>
            <th th:text="#{user.table.verify}">Verification</th>
            <th th:text="#{user.table.status}">Account Status</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user, iterStat : ${users}">
            <td th:text="${iterStat.index + 1}">1</td>
            <td th:text="${user.name}">User Name</td>
            <td th:text="${user.email}">user@example.com</td>
            <td>
            <span class="badge"
                  th:classappend="${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).admin} ? 'bg-danger' :
                                 (${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).owner} ? 'bg-primary' :
                                 (${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).pending_owner} ? 'bg-warning text-dark' : 'bg-secondary'))"
                  th:text="${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).admin} ? #{user.role.admin} :
                           (${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).renter} ? #{user.role.renter} :
                           (${user.role == T(naitei.group5.workingspacebooking.entity.enums.UserRole).owner} ? #{user.role.owner} : #{user.role.pending.owner}))">
                Role
            </span>
            </td>

            <!-- Cột xác minh chủ sở hữu -->
            <td>
                <form th:if="${user.role.name() == 'pending_owner'}"
                      th:action="@{'/admin/users/' + ${user.id} + '/approve-owner'}"
                      method="post">
                    <button type="submit" class="btn btn-success btn-sm"
                            th:text="#{user.action.approve.owner}">Approve</button>
                </form>
                <span th:if="${user.role.name() != 'pending_owner'}" class="text-muted">—</span>
            </td>

            <!-- Cột trạng thái tài khoản -->
            <td>
                <form th:if="${user.role.name() != 'admin'}"
                      th:action="@{'/admin/users/' + ${user.id} + '/toggle'}"
                      method="post"
                      th:onsubmit="${user.deleted} ? 'return confirm(\'Bạn có chắc chắn muốn kích hoạt lại tài khoản này?\');'
                                  : 'return confirm(\'Bạn có chắc chắn muốn vô hiệu hóa tài khoản này?\');'}">
                    <button type="submit"
                            class="btn btn-sm"
                            th:classappend="${user.deleted} ? 'btn-primary' : 'btn-danger'"
                            th:text="${user.deleted} ? #{user.action.enable} : #{user.action.disable}">
                        Toggle
                    </button>
                </form>
                <span th:if="${user.role.name() == 'admin'}" class="text-muted">—</span>
            </td>
        </tr>

        <tr th:if="${#lists.isEmpty(users)}">
            <td colspan="6" class="text-center text-muted" th:text="#{user.table.empty}">No users found</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
